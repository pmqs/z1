name: OpenBSD

# only run on demand
on: workflow_dispatch

jobs:
  configure:
    name: OpenBSD + ${{ matrix.compiler }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        compiler:
        - gcc
        - clang

    steps:
      - uses: actions/checkout@v4
      - uses: vmactions/openbsd-vm@v1
        with:
          usesh: true
          run: |
            ASSUME_ALWAYS_YES=YES pkg install ${{ matrix.compiler }}
            ${{ matrix.compiler }} -v
            make -f unix/Makefile flags CC=${{ matrix.compiler }}
            sed -i.bak -e 's/CF="/CF=" -Werror /' flags
            make -f unix/Makefile generic CC=${{ matrix.compiler }}
            ./zip -help
            ./zip -v
            ./zipnote -help
            ./zipnote -v
            ./zipsplit -help
            ./zipsplit -v